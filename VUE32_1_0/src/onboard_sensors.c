#include "onboard_sensors.h"
#include "def.h"

//////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                          //
//                                    Constants and variables                               //
//                                                                                          //
//////////////////////////////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                          //
//                                          Functions                                       //
//                                                                                          //
//////////////////////////////////////////////////////////////////////////////////////////////

char read_temp(unsigned short adc_in)
{
    //750mV @ 25C, 10mV/C
    //10 bits 3.3V ADC = 3.22mV/bit
    //~3bits/C, 750mV = 233bits

    //Test: 0C = 500mV (datasheet)
    //500mV/3.3V = 155.15bits
    //(155.15 - 233) / 3 + 25 = 0 Good

    return (((adc_in - 233)/3) + 25);
}

unsigned short read_vbat(unsigned short adc_in)
{
    //Divider: 10k over 30k, Vo/Vi = 10/(10+30) = 0.25
    //10 bits 3.3V ADC = 3.22mV/bit
    //1bit = 3.22mV*(1/0.25) = 12.88mV ~ 13mV/bit

    //Test: 11.97V/4 = 2.9925V = 928.6 bits
    //929*13mV = 12072mV (0.85% off) Good!

    return (adc_in * 13);
}