%Datalog analysis - Wheel sensor
%Freq: 681Hz, decoded period: 1.468ms/2 = 734µs
%734µs/800ns = 918

close all;
clear all;
clc;

format short eng

maxvalue = 65535;
data = [62649 1056 1852 2620 3417 4186 4982 5751 6547 7316 8111 8881 9677 10446 11242 12011 12807 13576 14372 15141 15936 16706 17501 18271 19066 19836 20631 21401 22197 22966 23762 24531 25327 26096 26891 27661 28457 29226 30021 30791 31586 32356 33151 33929 34716 35485 36281 37050 37846 38615 39411 40181 40976 41745 42540 43311 44106 44876 45671 46441 47236 48005 48800 49570 50366 51135 51931 52700 53496 54265 55061 55830 56626 57395 58191 58960 59755 60525 61320 62090 62886 63655 64450 65220 480 1249 2044 2814 3609 4379 5174 5944 6740 7509 8305 9074 9869 10639 11435 12204 12999 13769 14564 15334 16129 16898 17694 18464 19260 20029 20825 21594 22389 23158 23954 24723 25519 26288 27084 27853 28649 29418 30214 30983 31779 32548 33344 34113 34909 35678 36474 37244 38039 38808 39604 40373 41169 41938 42734 43503 44299 45068 45864 46633 47429 48198 48994 49763 50559 51328 52124 52893 53689 54458 55253 56023 56818 57587 58383 59153 59948 61514 62283 63078 63848 64643 65412 672 1442 2237 3007 3802 4571 5367 6137 6932 7702 8497 9267 10062 10832 11627 12397 13192 13961 14757 15527 16322 17091 17887 18657 19452 20221 21017 21787 22582 23352 24147 24916 25712 26482 27277 28047 28842 29612 30407 31176 31972 32741 33537 34306 35101 35872 36667 37437 38232 39001 39797 40566 41362 42131 42927 43696 44491 45261 46057 46826 47621 48391 49186 49956 50751 51520 52316 53086 53881 54651 55446 56216 57011 57781 58576 59346 60141 60911 61706 62475 63271 64041 64836 70 865 1635 2430 3200 3995 4765 5560 6329 7125 7895 8690 9460 10255 11024 11820 12590 13384 14155 14950 15720 16515 17285 18080 18849 19645 20414 21210 21980 22775 23545 24340 25110 25905 26674 27470 28239 29035 29804 30599 31369 32165 32934 33730 34500 35295 36064 36859 37629 38424 39195 39989 40759 41554 42324 43120 43889 44684 45454 46250 47019 47814 48584 49379 50149 50944 51714 52509 53279 54074 54844 55639 56409 57205 57974 58769 59538 60334 61103 61899 62668 63464 64234 65029 262 1058 1828 2623 3393 4187 4957 5752 6522 7318 8087 8883 9651 10448 11217 12013 12782 13578 14348 15143 15912 16707 17477 18273 19042 19838 20607 21403 22172 22967 23737 24532 25302 26097 26867 27662 28432 29228 29997 30792 31561 32358 33127 33922 34692 35488 36257 37052 37822 38617 39387 40182 40952 41747 42517 43312 44082 44877 45647 46442 47211 48006 48777 49572 50342 51137 51906 52702 53471 54267 55037 55832 56602 57397 58166 58962 59732 60527 61297 62092 62861 63657 64426 65222 456 1251 2020 2815 3585 4380 5150 5944 6715 7511 8280 9076 9846 10640 11410 12205 12975 13770 14540 15335 16105 16901 17670 18466 19235 20030 20800 21595 22365 23160 23930 24725 25495 26290 27060 27854 28625 29420 30190 30985 31755 32550 33319 34115 34885 35680 36450 37245 38015 38810 39580 40375 41145 41940 42710 43505 44275 45070 45839 46635 47404 48200 48969 49765 50535 51330 52100 52895 53665 54472 55229 56025 56794 57590 58359 59155 59925 60720 61489 62285 63054 63850 64619 65414 648 1443 2213 3009 3779 4574 5343 6139 6908 7703 8473 9268 10039 10833 11603 12398 13168 13964 14733 15528 16298 17093 17862 18658 19428 20223 20993 21788 22558 23352 24123 24918 25688 26483 27253 28048 28818 29613 30382 31178 31948 32743 33513 34308 35078 35873 36643 37438 38208 39003 39773 40568 41338 42132 42902 43698 44467 45263 46032 46828 47598 48393 49162 49958 50727 51522 52292 53087 53857 54653 55422 56218 56987 57783 58552 59347 60117 60913 61682 62477 63246 64042 64812 71 841 1636 2405 3202 3971 4766 5536 6331 7101 7896 8665 9461 10231 11026 11796 12591 13361 14156 14925 15721 16490 17286 18055 18851 19621 20415 21186 21981 22751 23546 24316 25111 25880 26676 27446 28241 29011 29806 30576 31371 32140 32936 33706 34501 35271 36066 36835 37631 38400 39195 39965 40761 41530 42325 43096 43891 44660 45456 46226 47020 47790 48585 49355 50151 50920 51716 52485 53280 54050 54845 55615 56410 57180 57975 58745 59540 60310 61105 61875 62670 63440 64235 65005 264 1034 1829 2599 3394 4164 4959 5729 6523 7294 8089 8859 9654 10424 11219 11989 12784 13554 14349 15119 15914 16684 17479 18249 19044 19814 20610 21379 22174 22944 23739 24508 25304 26073 26869 27639 28434 29204 29999 30768 31564 32334 33129 33899 34694 35463 36259 37028 37824 38593 39389 40159 40954 41724 42519 43288 44084 44853 45649 46428 47214 47984 48779 49549 50343 51113 51909 52678 53474 54243 55039 55808 56603 57373 58169 58938 59734 60502 61299 62068 62864 63633 64429 65198 458 1227 2022 2792 3587 4357 5153 5922 6718 7487 8282 9052 9847 10617 11412 12182 12977 13747 14542 15312 16108 16877 17673 18442 19237 20007 20803 21572 22367 23137 23932 24702 25497 26267 27062 27832 28627 29397 30192 30962 31757 32527 33322 34092 34887 35657 36453 37222 38017 38787 39583 40352 41147 41917 42712 43482 44277 45047 45843 46612 47407 48177 48972 49742 50537 51307 52102 52871 53667 54437 55232 56002 56796 57566 58362 59132 59927 60697 61492 62262 63057 63826 64622 65391 651 1421 2216 2985 3781 4551 5346 6115 6911 7680 8476 9245 10041 10810 11606 12376 13172 13940 14736 15506 16301 17070 17866 18635 19431 20200 20996 21766 22561 23331 24126 24896 25691 26461 27256 28025 28821 29593 30386 31155 31951 32720 33516 34286 35082 35851 36646 37416 38211 38980 39776 40545 41341 42111 42906 43675 44471 45240 46036 46806 47601 48370 49166 49935 50731 51500 52296 53065 53861 54630 55426 56196 56991 57760 58555 59325 60120 60890 61685 62455 63251 64020 64816 49 844 1614 2410 3179 3974 4744 5539 6309 7104 7874 8670 9438 10235 11004 11800 12569 13365 14134 14929 15699 16494 17264 18059 18829 19625 20394 21190 21959 22755 23524 24319 25089 25884 26654 27450 28219 29014 29784 30580 31349 32145 32914 33710 34479 35275 36044 36839 37609 38405 39174 39970 40739 41534 42304 43099 43869 44664 45434 46229 46999 47794 48564 49359 50129 50925 51694 52489 53260 54054 54824 55619 56389 57184 57954 58749 59519 60314 61084 61879 ];

figure(1)
plot(data(5:end))

indx = 1;
for i = 1:1:length(data)-1

    ts1 = data(indx+1);
    ts2 = data(indx);
    indx = indx+1;

    if(ts1 > ts2)
        period = ts1 - ts2;
    elseif (ts1 == ts2)
        period = 0;
    else
        period = ts1 + (maxvalue - ts2);
    end
    
    log_period(indx) = period;
    
end

figure()
plot(log_period(5:end))
